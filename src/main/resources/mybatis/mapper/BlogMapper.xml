<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.luban.mapper.BlogMapper">
    <resultMap id="myUserMap" type = "mybatis.luban.model.UserDO">
        <id property="id" column="id"/>
        <result property="name" column="title"/>
    </resultMap>

    <resultMap id="BaseBlogMap" type="mybatis.luban.model.BlogMap">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
<!-- 复合映射 -->
<!--        <association property="author" >-->
<!--            <id property="id" column="id"/>-->
<!--            <result property="name" column="title"/>-->
<!--        </association>-->

<!-- 外部映射，resultMap与select不能同时存在。如果存在resultMap，则复合映射失效 -->
<!--        <association property="author" resultMap="myUserMap">-->
<!--        </association>-->

        <!-- 1:1 嵌套子查询 fetchType="eager"关闭懒加载-->
<!--        <association property="author" column="user_id" select="mybatis.luban.mapper.UserMapper.selectUserById" />-->
        <!-- 1:n 嵌套子查询-->
        <!-- column 也可以为子查询传递多个参数-->
<!--        <collection property="comments" column="commentId = comment_id, blogId = blog_id" select="mybatis.luban.mapper.CommentMapper.selectCommentsByBlogId"/>-->
        <collection property="comments" column="comment_id" select="mybatis.luban.mapper.CommentMapper.selectCommentsByBlogId"/>
<!--        <collection property="comments" column="comment_id" select="mybatis.luban.mapper.CommentMapper.selectCommentsByBlogId" fetchType="lazy"/>-->
    </resultMap>


    <resultMap id="BaseBlogMap2" type="mybatis.luban.model.BlogMap">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
        <collection property="comments"  autoMapping="true" columnPrefix="comment_" ofType="commentMap"/>
    </resultMap>

    <resultMap id="BaseBlogMap3" type="mybatis.luban.model.BlogMap3">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
        <collection property="comments"  autoMapping="true" columnPrefix="comment_" ofType="commentMap">
            <association property="blog" resultMap="BaseBlogMap3" />
        </collection>
    </resultMap>

    <resultMap id="BaseBlogMap4" type="mybatis.luban.model.BlogMap">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
<!--        <association property="author" column="user_id" select="mybatis.luban.mapper.UserMapper.selectUserById"/>-->
        <collection property="comments" column="comment_id" select="mybatis.luban.mapper.CommentMapper.selectCommentsByBlogId" fetchType="eager"/>
    </resultMap>

    <select id="selectBlogById" resultMap="BaseBlogMap">
        select * from blog where id = #{id}
    </select>

    <select id="selectBlogById2" resultMap="BaseBlogMap2">
        select a.id,a.title,c.id as comment_id,c.content as comment_content
        from blog a left join comment c on a.id = c.blog_id
        where a.id = #{id}
    </select>


    <select id="selectBlogById3" resultMap="BaseBlogMap3">
        select a.id,a.title,c.id as comment_id,c.content as comment_content
        from blog a left join comment c on a.id = c.blog_id
        where a.id = #{id}
    </select>

    <select id="selectBlogById4" resultMap="BaseBlogMap4">
        select * from blog where id = #{id}
    </select>
</mapper>